<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        Node.js - Day 2 - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,600,600italic,300italic,300|Source+Serif+Pro|Source+Code+Pro:400,300,500&subset=latin,latin-ext);.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\A0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.markdown-body kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,sans-serif;padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram{text-align:center;background-color:inherit;border-radius:0;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p,.markdown-body .alert>ul{margin-bottom:0}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.MJX_Assistive_MathML{display:none}.ui-infobar{position:relative;z-index:2;max-width:758px;margin-top:25px;margin-bottom:-25px;color:#777}.ui-toc{position:fixed;bottom:20px;z-index:10000}.ui-toc-label{opacity:.3;background-color:#ccc;border:none;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:23px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child > ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,Hiragino Kaku Gothic Pro,\\30D2\30E9\30AE\30CE\89D2\30B4 Pro W3,Osaka,Meiryo,\\30E1\30A4\30EA\30AA,MS Gothic,"\FF2D\FF33   \30B4\30B7\30C3\30AF",sans-serif}.ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,"\FF2D\FF33   \FF30\30B4\30B7\30C3\30AF",sans-serif}.markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang TC,Microsoft JhengHei,\\5FAE\8EDF\6B63\9ED1,sans-serif}.ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,\\5FAE\8EDF\6B63\9ED1UI,sans-serif}.markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang SC,Microsoft YaHei,\\5FAE\8F6F\96C5\9ED1,sans-serif}.ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,\\5FAE\8F6F\96C5\9ED1UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:3px;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:contain}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}small span{line-height:22px}small .dropdown{display:inline-block}small .dropdown a:focus,small .dropdown a:hover{text-decoration:none}.unselectable{-moz-user-select:none;-webkit-user-select:none;-o-user-select:none;user-select:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}.focus,:focus{outline:none!important}::-moz-focus-inner{border:0!important}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid"><h1 id="nodejs-day-2" style=""><a class="anchor hidden-xs" href="#nodejs-day-2" title="nodejs-day-2"><span class="octicon octicon-link"></span></a>Node.js - Day 2</h1><p>Up until now we’ve been dealing with synchronous functions, i.e. when we write our lines of code they run in order, right after each other. That notion is going to die today. JavaScript is known for it’s use of asynchronous programming, where execution order is not defined.</p><p>Before we get into asynchronicity, we’ll touch on <em>anonymous functions</em> and <em>arrow functions</em>.</p><h2 id="anonymous-functions" style=""><a class="anchor hidden-xs" href="#anonymous-functions" title="anonymous-functions"><span class="octicon octicon-link"></span></a>Anonymous Functions</h2><p>You can think of an anonymous function as a function without a name. They can be declared whenever you like.</p><p>Think of an anonymous function as an expression.</p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span></div><div class="code"><span class="hljs-keyword">let</span> something = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hmm?'</span>);
};
</div></div></code></pre><p>So with the above, we’re making a function on the right-hand side, and then assigning <code>something</code> to it. It’s hard to get a use-case of this right now without going into callbacks, so first, we’ll talk about passing simply passing functions as arguments.</p><h2 id="passing-a-function-as-an-argument" style=""><a class="anchor hidden-xs" href="#passing-a-function-as-an-argument" title="passing-a-function-as-an-argument"><span class="octicon octicon-link"></span></a>Passing a Function as an Argument</h2><p>Let’s take a normal function which prints the words <code>hi there</code>.</p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span></div><div class="code"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sayHello</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hi there'</span>);
}
</div></div></code></pre><p>That’s simple enough. Now we’re going make a function that will execute a function that you pass into it.</p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span></div><div class="code"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runIt</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'I guess I\'ll run your function...'</span>);
    
    fn();
    
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Are you happy now?'</span>);
}
</div></div></code></pre><p>Now we’re going to call <code>runIt()</code> with <code>sayHello()</code> as an argument.</p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="13"></span></div><div class="code">runIt(sayHello);
</div></div></code></pre><p><img src="https://i.imgur.com/06GT8e4.png" alt=""><br>
<img src="https://i.imgur.com/m2ZvJxY.png" alt=""></p><p>The output shouldn’t be too surprising. We defined the <code>sayHello()</code> function, and when we wanted to run <code>runIt()</code> we told it to run that one between it’s two <code>console.log</code>'s.</p><p>Now let’s try calling this with an anonymous function like the following:</p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span></div><div class="code">runIt(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'goodbye'</span>);
});
</div></div></code></pre><p><img src="https://i.imgur.com/n9Ul6ot.png" alt=""><br>
<img src="https://i.imgur.com/MPhVHHK.png" alt=""></p><p>You can see we just made the anonymous function right in the function call. We never needed to assign it to anything.</p><h2 id="arrow-functions" style=""><a class="anchor hidden-xs" href="#arrow-functions" title="arrow-functions"><span class="octicon octicon-link"></span></a>Arrow Functions</h2><p>Arrow functions are like anonymous functions… but shorter.</p><p>This syntax is effectively the same:</p><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'anonymous'</span>);
}
</code></pre><pre><code class="javascript hljs">() =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'arrow'</span>);
}
</code></pre><p>There is also another trick, though, where these are also the same:</p><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt; some expression &gt;'</span>;
}
</code></pre><pre><code class="javascript hljs">() =&gt; <span class="hljs-string">'&lt; some expression &gt;'</span>
</code></pre><p>Quick one-liners are simpler in arrow function form.</p><p>Now just like anonymous functions, we can assign them to variables if you’d like.</p><h3 id="some-math-examples" style=""><a class="anchor hidden-xs" href="#some-math-examples" title="some-math-examples"><span class="octicon octicon-link"></span></a>Some Math Examples</h3><p>Arrow functions are convenient as well for short mathematical functions.</p><p>Let’s make a function that fulfills this:</p><p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msup><mi>a</mi><mn>4</mn></msup><mi>b</mi><mo>+</mo><mn>2</mn></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 8.459em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.093em; height: 0px; font-size: 119%;"><span style="position: absolute; clip: rect(1.473em, 1007.093em, 2.891em, -999.997em); top: -2.518em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.16em;"></span></span><span class="mo" id="MathJax-Span-4" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-5" style="font-family: STIXGeneral-Italic;">a</span><span class="mo" id="MathJax-Span-6" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-7" style="font-family: STIXGeneral-Italic; padding-left: 0.213em;">b</span><span class="mo" id="MathJax-Span-8" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-9" style="font-family: STIXGeneral-Regular; padding-left: 0.318em;">=</span><span class="msubsup" id="MathJax-Span-10" style="padding-left: 0.318em;"><span style="display: inline-block; position: relative; width: 0.948em; height: 0px;"><span style="position: absolute; clip: rect(3.416em, 1000.475em, 4.152em, -999.997em); top: -3.989em; left: 0em;"><span class="mi" id="MathJax-Span-11" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span><span style="position: absolute; top: -4.409em; left: 0.528em;"><span class="mn" id="MathJax-Span-12" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">4</span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span></span></span><span class="mi" id="MathJax-Span-13" style="font-family: STIXGeneral-Italic;">b</span><span class="mo" id="MathJax-Span-14" style="font-family: STIXGeneral-Regular; padding-left: 0.265em;">+</span><span class="mn" id="MathJax-Span-15" style="font-family: STIXGeneral-Regular; padding-left: 0.265em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.524em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>a</mi><mn>4</mn></msup><mi>b</mi><mo>+</mo><mn>2</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">
f(a, b)=a^4 b + 2
</script></span></p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span></div><div class="code"><span class="hljs-keyword">let</span> f = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-built_in">Math</span>.pow(a, <span class="hljs-number">4</span>) * b + <span class="hljs-number">2</span>;
</div></div></code></pre><p>Calling <code>f(3, 2)</code> should simply give you 164.</p><p>The above only had one simple step, so we used the convenient expression form to return the value immediately.</p><p>Extending this example with another function…</p><p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><msup><mi>x</mi><mn>2</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-16" style="width: 9.141em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.671em; height: 0px; font-size: 119%;"><span style="position: absolute; clip: rect(1.473em, 1007.618em, 2.891em, -999.997em); top: -2.518em; left: 0em;"><span class="mrow" id="MathJax-Span-17"><span class="mi" id="MathJax-Span-18" style="font-family: STIXGeneral-Italic;">g</span><span class="mo" id="MathJax-Span-19" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-20" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-21" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-22" style="font-family: STIXGeneral-Regular; padding-left: 0.318em;">=</span><span class="mi" id="MathJax-Span-23" style="font-family: STIXGeneral-Italic; padding-left: 0.318em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.16em;"></span></span><span class="mo" id="MathJax-Span-24" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-25" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-26" style="font-family: STIXGeneral-Regular; padding-left: 0.265em;">−</span><span class="mn" id="MathJax-Span-27" style="font-family: STIXGeneral-Regular; padding-left: 0.265em;">1</span><span class="mo" id="MathJax-Span-28" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-29" style="padding-left: 0.213em;"><span style="display: inline-block; position: relative; width: 0.948em; height: 0px;"><span style="position: absolute; clip: rect(3.416em, 1000.475em, 4.152em, -999.997em); top: -3.989em; left: 0em;"><span class="mi" id="MathJax-Span-30" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span><span style="position: absolute; top: -4.409em; left: 0.475em;"><span class="mn" id="MathJax-Span-31" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span></span></span><span class="mo" id="MathJax-Span-32" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.524em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>g</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mn>1</mn><mo>,</mo><msup><mi>x</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-2">
g(x)=f(x - 1, x^2)
</script></span></p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="2"></span></div><div class="code"><span class="hljs-keyword">let</span> g = <span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span> f(x - <span class="hljs-number">1</span>, <span class="hljs-built_in">Math</span>.pow(x, <span class="hljs-number">2</span>));
</div></div></code></pre><p>A quick note though: when the function has only one parameter (here being <code>x</code>), you may omit those parenthesis if you wish. Thus, we could’ve written this instead:</p><pre><code class="javascript hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="2"></span></div><div class="code"><span class="hljs-keyword">let</span> g = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> f(x - <span class="hljs-number">1</span>, <span class="hljs-built_in">Math</span>.pow(x, <span class="hljs-number">2</span>));
</div></div></code></pre><h3 id="why-use-these" style=""><a class="anchor hidden-xs" href="#why-use-these" title="why-use-these"><span class="octicon octicon-link"></span></a>Why Use These?</h3><p>So you might be wondering why you’d want to use this type of function over the regular one… because the regular one seems fine right?</p><p>Well, given how many functions you’ll have to pass into to other functions, it can make a big difference in readability.</p><div class="alert alert-info">
<p>There are some differences between regular functions and arrow functions, however, they are a little out of our scope at the moment.</p>
<p>If you’d like to know what’s different now, the MDN has a good description:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions</a></li>
</ul>
<p>In short, arrow functions don’t set a couple local variables normal functions do, we’ll see this when we hit object oriented programming.</p>
</div><h2 id="callbacks" style=""><a class="anchor hidden-xs" href="#callbacks" title="callbacks"><span class="octicon octicon-link"></span></a>Callbacks</h2><h3 id="doing-io" style=""><a class="anchor hidden-xs" href="#doing-io" title="doing-io"><span class="octicon octicon-link"></span></a>Doing I/O</h3><p>You may have noticed that we haven’t done any I/O (writing to a file) yet. Many tutorials for programming languages start with this right away, but we had to wait a bit.</p><p>To do any I/O in Node.js, you use the <code>fs</code> or <em>file system</em> module.</p><p>Let’s try writing to a file using <a href="https://nodejs.org/api/fs.html#fs_fs_writefile_file_data_options_callback" target="_blank"><code>fs.writeFile()</code></a>.</p><p>Now most likely, you’d expect to do it like this:</p><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

fs.writeFile(<span class="hljs-string">'myCoolFile.txt'</span>, <span class="hljs-string">'yolo'</span>);

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'I only lived once'</span>);
</code></pre><p>However… this does not work how you think it will.</p><p>“I only lived once” will actually print to the console <em>before</em> “yolo” prints to the file. Why? Because <code>fs.writeFile()</code> is an asynchronous function, it doesn’t  execute immediately, but executes some time in the future.</p><div class="alert alert-info">
<p>Node.js has a little bit of a strange way of importing modules (or external Node.js libraries).</p>
<p>The <code>require()</code> function takes care of importing things for you, and returns an object representing the library.</p>
<p>So in the above example we are importing the <code>fs</code> module and then assigning it to a constant called <code>fs</code>. Note that this variable name could be anything, but normally, we will name it the same as the module name.</p>
</div><p>If you click on the link above for the function you’ll see the that it accepts a callback argument at the end. <strong>An asynchronous callback is a function that gets called when an asynchronous function is done executing.</strong></p><p>So this here is correct-<em>ish</em> usage:</p><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

fs.writeFile(<span class="hljs-string">'myCoolFile.txt'</span>, <span class="hljs-string">'yolo'</span>, (err) =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'I only lived once'</span>);
});
</code></pre><p>We passed in an anonymous function as a <em>callback</em>. This function is called whenever <code>fs.writeFile()</code> is done.</p><div class="alert alert-danger">
<p>If you looked ahead and saw the function <code>fs.writeFileSync()</code> and thought, “well, why aren’t we using that instead?”, there’s a reason.</p>
<p>Using a “Sync” method in the <code>fs</code> module is dangerous. The strength of asynchronous programming is that other functions can execute in the background. Using a synchronous function that takes a long time to execute in Node.js freezes all background tasks. You will almost always have some running somewhere.</p>
<p>The only exception to this rule, where it is okay to use synchronous functions like <code>fs.writeFileSync()</code> is if you’re writing something like an install script. If you’re ever in doubt though, don’t use the synchronous functions.</p>
</div><h3 id="what-did-we-do-before" style=""><a class="anchor hidden-xs" href="#what-did-we-do-before" title="what-did-we-do-before"><span class="octicon octicon-link"></span></a>What did we do before?</h3><p>In the <em>Passing an Argument as a Function</em> section, we actually did make a function that accepts a callback. <code>RunIt()</code> used a <em>synchronous callback</em>. In that case <code>fn</code> was called immediately in the function and was not scheduled to run in the future like in our I/O example.</p><h3 id="handling-errors" style=""><a class="anchor hidden-xs" href="#handling-errors" title="handling-errors"><span class="octicon octicon-link"></span></a>Handling Errors</h3><p>So in our above example with <code>fs.writeFile()</code>, we didn’t actual check if our operation failed or not. We accepted <code>err</code> as an argument but never checked it.</p><p>So by convention, most async functions call a callback with an error as the first argument. <em>If there is no error, this value is simply <code>null</code> (or I guess it could be<code>undefined</code>).</em></p><p>A common thing to do would be something like this:</p><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

fs.writeFile(<span class="hljs-string">'myCoolFile.txt'</span>, <span class="hljs-string">'yolo'</span>, (err) =&gt; {
    <span class="hljs-comment">// console.error() logs to stderr instead of stdout</span>
    <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.error(err);
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'I only lived once'</span>);
});
</code></pre><p>If there’s an error, we’ll print it, otherwise we’ll print what we wanted. It’s almost always a good idea to put something like</p><pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(err);
</code></pre><p>at the beginning of your callbacks, just in case there are any problems. You’ll just print and kill the function.</p><h3 id="getting-data" style=""><a class="anchor hidden-xs" href="#getting-data" title="getting-data"><span class="octicon octicon-link"></span></a>Getting Data</h3><p>So with our writing to a file example, the callback only accepted an argument. What if we read a file? Then we’ll need to accept the data as well.</p><p>Just like with <code>fs.writeFile()</code>, we’ll use <a href="https://nodejs.org/api/fs.html#fs_fs_readfile_path_options_callback" target="_blank"><code>fs.readFile()</code></a> to do that.</p><p>So to read our <code>myCoolFile.txt</code> that we had above, <em>without worrying about the file encoding quite yet</em>, looks similar.</p><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

fs.readFile(<span class="hljs-string">'myCoolFile.txt'</span>, (err, data) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.error(err);
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">console</span>.log(data);
});
</code></pre><p>We’re catching our error just in case, and then printing out the data that gets passed through our callback.</p><p>If you were to run this, you’d get an output like <code>&lt;Buffer 79 6f 6c 6f 0a&gt;</code>. We need to specify an encoding, otherwise we’re getting the raw file.</p><p>For just about most purposes, you’ll use <code>utf-8</code>. It’s the most frequently used character encoding out there.</p><p>So to actually be able to make sense of our file, we’ll call it like this:</p><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

fs.readFile(<span class="hljs-string">'myCoolFile.txt'</span>, <span class="hljs-string">'utf-8'</span>, (err, data) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.error(err);
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">console</span>.log(data);
});
</code></pre><p>Now we can print the <code>'yolo'</code> that we all know and love.</p><h3 id="sleeping" style=""><a class="anchor hidden-xs" href="#sleeping" title="sleeping"><span class="octicon octicon-link"></span></a>Sleeping <img alt=":sleeping:" class="emoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/sleeping.png" title=":sleeping:"></h3><p>Another thing we haven’t touched on is sleeping, or delaying execution. As you may have guessed, we haven’t done this because it requires callbacks.</p><p>Now in a language like Python, we just do it like this:</p><pre><code class="javascript hljs"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep

print(<span class="hljs-string">'Ha...'</span>)

sleep(<span class="hljs-number">1</span>)

print(<span class="hljs-string">'choo.'</span>)
</code></pre><p>We simply print a line, wait a second, and then print another.</p><p>Sadly, it’s trickier than that here. Instead of wasting time, I’ll just show you how you’d do it.</p><pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Ha...'</span>);

setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'choo.'</span>);
}, <span class="hljs-number">1000</span>);
</code></pre><p>So here we print a line, then call the global function <code>setTimeout()</code> to schedule our anonymous function 1000 milliseconds into the future. This gives the same output as the synchronous Python from above.</p><p>Now if we want to do this process again, and wait for more time. we put another <code>setTimeout()</code> in the callback.</p><pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Ha...'</span>);

setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'choo.'</span>);
    
    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'&gt; Bless you!'</span>);
    }, <span class="hljs-number">3000</span>);
}, <span class="hljs-number">1000</span>);
</code></pre><p>As you may guess, now 3 seconds later, someone says bless you.</p><div class="alert alert-warning">
<p>So there’s some uncertainty of when callbacks will run, this is at the heart of async programming.</p>
<p>Now you may instead try to do the above example like this:</p>
<pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Ha...'</span>);

setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'choo.'</span>);
}, <span class="hljs-number">1000</span>);

setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'&gt; Bless you!'</span>);
}, <span class="hljs-number">4000</span>);

</code></pre>
<p>This, however, is not good programming. Since the printing of bless you needs to happen after a certain amount of time after the end of the sneeze, we need set the point to wait <em>after</em> the sneeze is done.</p>
<p>With this bad usage here, it’s totally possible that <code>choo.</code> could be printed kind of late, and that <code>&gt; Bless you!</code> gets printed sooner than you expect.</p>
</div><h3 id="callback-hell" style=""><a class="anchor hidden-xs" href="#callback-hell" title="callback-hell"><span class="octicon octicon-link"></span></a>Callback Hell</h3><p>So you saw how we nested a callback, <em>inside another callback.</em> This can get out of control in what we affectionately call <em>callback hell</em> or the <em>pyramid of doom</em>.</p><p>Image this slightly contrived example, we write to a file, then read it, then write to it again, then read it.</p><p>This looks like so:</p><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> { writeFile, readFile } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

writeFile(<span class="hljs-string">'hmm.txt'</span>, <span class="hljs-string">'1'</span>, (err) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(err);
    
    readFile(<span class="hljs-string">'hmm.txt'</span>, <span class="hljs-string">'utf-8'</span>, (err, data) =&gt; {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(err);
    
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'We printed '</span> + data + <span class="hljs-string">' the first time.'</span>);
    
        writeFile(<span class="hljs-string">'hmm.txt'</span>, <span class="hljs-string">'2'</span>, (err) =&gt; {
            <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(err);
    
            readFile(<span class="hljs-string">'hmm.txt'</span>, <span class="hljs-string">'utf-8'</span>, (err, data) =&gt; {
                <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(err);
    
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'We printed '</span> + data + <span class="hljs-string">' the second time.'</span>);
            });
        });
    });
});
</code></pre><div class="alert alert-info">
<p>That weird import is called <em>destructuring assignment</em>, it’s nice when importing multiple things from one source.</p>
<p>Check it out here: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment</a></p>
</div><p>You can probably see how we keep getting this nested behavior, because we have to wait for the last action to finish before doing the next. There are ways to avoid this that you’ll learn later.</p><h2 id="extra-reading" style=""><a class="anchor hidden-xs" href="#extra-reading" title="extra-reading"><span class="octicon octicon-link"></span></a>Extra Reading</h2><p>If you’re curious about the internals of Node.js, and all of these callbacks work, check out <a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/" target="_blank">this&nbsp;page</a> on how the Node.js event loop works.</p><hr><h2 id="practice" style=""><a class="anchor hidden-xs" href="#practice" title="practice"><span class="octicon octicon-link"></span></a>Practice</h2><div class="alert alert-success">
<p><span style="float:left"><img alt=":relieved:" class="emoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/relieved.png" title=":relieved:"></span></p>
<p><span style="float:right"><img alt=":relieved:" class="emoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/relieved.png" title=":relieved:"></span></p>
<center>Easy</center> 
<br>
<p>Make an arrow function that satisfies the following equation:</p>
<p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msqrt><mi>x</mi><mo>!</mo></msqrt></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-33" style="width: 5.255em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.414em; height: 0px; font-size: 119%;"><span style="position: absolute; clip: rect(1.578em, 1004.414em, 2.891em, -999.997em); top: -2.518em; left: 0em;"><span class="mrow" id="MathJax-Span-34"><span class="mi" id="MathJax-Span-35" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.16em;"></span></span><span class="mo" id="MathJax-Span-36" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-37" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-38" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-39" style="font-family: STIXGeneral-Regular; padding-left: 0.318em;">=</span><span class="msqrt" id="MathJax-Span-40" style="padding-left: 0.318em;"><span style="display: inline-block; position: relative; width: 1.526em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.685em, 4.152em, -999.997em); top: -3.989em; left: 0.738em;"><span class="mrow" id="MathJax-Span-41"><span class="mi" id="MathJax-Span-42" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-43" style="font-family: STIXGeneral-Regular;">!</span></span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span><span style="position: absolute; clip: rect(2.996em, 1000.79em, 3.364em, -999.997em); top: -3.989em; left: 0.738em;"><span style="display: inline-block; position: relative; width: 0.79em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -3.989em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 3.994em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -3.989em; left: 0.318em;">‾<span style="display: inline-block; width: 0px; height: 3.994em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span><span style="position: absolute; clip: rect(2.891em, 1000.79em, 4.152em, -999.997em); top: -3.831em; left: 0em;"><span style="font-family: STIXVariants;">√</span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.524em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msqrt><mi>x</mi><mo>!</mo></msqrt></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-3">
f(x) = \sqrt{x!}
</script></span></p>
<p>Then, make another arrow function that satisfies this:</p>
<p><span class="mathjax"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msup><mi>b</mi><mn>2</mn></msup><mo>&amp;#x22C5;</mo><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>a</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-44" style="width: 8.774em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.356em; height: 0px; font-size: 119%;"><span style="position: absolute; clip: rect(1.473em, 1007.303em, 2.891em, -999.997em); top: -2.518em; left: 0em;"><span class="mrow" id="MathJax-Span-45"><span class="mi" id="MathJax-Span-46" style="font-family: STIXGeneral-Italic;">g</span><span class="mo" id="MathJax-Span-47" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-48" style="font-family: STIXGeneral-Italic;">a</span><span class="mo" id="MathJax-Span-49" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-50" style="font-family: STIXGeneral-Italic; padding-left: 0.213em;">b</span><span class="mo" id="MathJax-Span-51" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-52" style="font-family: STIXGeneral-Regular; padding-left: 0.318em;">=</span><span class="msubsup" id="MathJax-Span-53" style="padding-left: 0.318em;"><span style="display: inline-block; position: relative; width: 0.948em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.475em, 4.152em, -999.997em); top: -3.989em; left: 0em;"><span class="mi" id="MathJax-Span-54" style="font-family: STIXGeneral-Italic;">b</span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span><span style="position: absolute; top: -4.409em; left: 0.528em;"><span class="mn" id="MathJax-Span-55" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 3.994em;"></span></span></span></span><span class="mo" id="MathJax-Span-56" style="font-family: STIXGeneral-Regular; padding-left: 0.265em;">⋅</span><span class="mi" id="MathJax-Span-57" style="font-family: STIXGeneral-Italic; padding-left: 0.265em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.16em;"></span></span><span class="mo" id="MathJax-Span-58" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-59" style="font-family: STIXGeneral-Italic;">a</span><span class="mo" id="MathJax-Span-60" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.524em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>g</mi><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>b</mi><mn>2</mn></msup><mo>⋅</mo><mi>f</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-4">
g(a, b) = b^2\cdot f(a) 
</script></span></p>
</div><div class="alert alert-warning">
<p><span style="float:left"><img alt=":unamused:" class="emoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/unamused.png" title=":unamused:"></span></p>
<p><span style="float:right"><img alt=":unamused:" class="emoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/unamused.png" title=":unamused:"></span></p>
<center>Moderate</center> 
<br>
<p>Try the above problem, but define <span class="mathjax"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-61" style="width: 1.893em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.578em; height: 0px; font-size: 119%;"><span style="position: absolute; clip: rect(1.683em, 1001.526em, 2.891em, -999.997em); top: -2.518em; left: 0em;"><span class="mrow" id="MathJax-Span-62"><span class="mi" id="MathJax-Span-63" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.16em;"></span></span><span class="mo" id="MathJax-Span-64" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-65" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-66" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.524em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">f(x)</script></span> in one line without any for loops.</p>
<p>This is a little tricky so I’ll throw some hints:</p>
<ul>
<li><code>Array.from(Array(n).keys())</code> will make an array from 1 to n - 1.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank"><code>Array.prototype.reduce</code></a> can reduce an array down to a single value.
<ul>
<li>Note that this function uses a synchronous callback, i.e., the callback is executed immediately.</li>
</ul>
</li>
</ul>
</div><div class="alert alert-warning">
<p><span style="float:left"><img alt=":unamused:" class="emoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/unamused.png" title=":unamused:"></span></p>
<p><span style="float:right"><img alt=":unamused:" class="emoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/images/basic/unamused.png" title=":unamused:"></span></p>
<center>Moderate</center> 
<br>
<p>Recursively list all the files in a directory, you’ll need to use the <code>fs</code> module to do this.</p>
<p>Return everything as a list like:</p>
<pre><code class="javascript hljs">[<span class="hljs-string">'lib/goodbye.js'</span>, <span class="hljs-string">'lib/hello.js'</span>, <span class="hljs-string">'lib/z/katze.cat'</span>]
</code></pre>
</div></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav"><li class=""><a href="#nodejs-day-2">Node.js - Day 2</a><ul class="nav"><li class=""><a href="#anonymous-functions">Anonymous Functions</a></li><li class=""><a href="#passing-a-function-as-an-argument">Passing a Function as an Argument</a></li><li class=""><a href="#arrow-functions">Arrow Functions</a><ul class="nav"><li class=""><a href="#some-math-examples">Some Math Examples</a></li><li class=""><a href="#why-use-these">Why Use These?</a></li></ul></li><li class=""><a href="#callbacks">Callbacks</a><ul class="nav"><li class=""><a href="#doing-io">Doing I/O</a></li><li class=""><a href="#what-did-we-do-before">What did we do before?</a></li><li class=""><a href="#handling-errors">Handling Errors</a></li><li class=""><a href="#getting-data">Getting Data</a></li><li class=""><a href="#sleeping">Sleeping </a></li><li class=""><a href="#callback-hell">Callback Hell</a></li></ul></li><li class=""><a href="#extra-reading">Extra Reading</a></li><li class=""><a href="#practice">Practice</a></li></ul></li></ul></div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;"  >
        <div class="toc"><ul class="nav"><li class=""><a href="#nodejs-day-2">Node.js - Day 2</a><ul class="nav"><li class=""><a href="#anonymous-functions">Anonymous Functions</a></li><li class=""><a href="#passing-a-function-as-an-argument">Passing a Function as an Argument</a></li><li class=""><a href="#arrow-functions">Arrow Functions</a><ul class="nav"><li class=""><a href="#some-math-examples">Some Math Examples</a></li><li class=""><a href="#why-use-these">Why Use These?</a></li></ul></li><li class=""><a href="#callbacks">Callbacks</a><ul class="nav"><li class=""><a href="#doing-io">Doing I/O</a></li><li class=""><a href="#what-did-we-do-before">What did we do before?</a></li><li class=""><a href="#handling-errors">Handling Errors</a></li><li class=""><a href="#getting-data">Getting Data</a></li><li class=""><a href="#sleeping">Sleeping </a></li><li class=""><a href="#callback-hell">Callback Hell</a></li></ul></li><li class=""><a href="#extra-reading">Extra Reading</a></li><li class=""><a href="#practice">Practice</a></li></ul></li></ul></div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
